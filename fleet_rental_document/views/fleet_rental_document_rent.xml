<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

      <menuitem name="Rental documents" parent="base.menu_base_partner" id="fleet_sale" sequence="2"/>
      <menuitem name="Rents" parent="fleet_sale" id="fleet_rental_sale" sequence="1"/>
      <menuitem name="Extends" parent="fleet_sale" id="fleet_rental_sale_extends" sequence="2" groups="group_fleet_rental_extra_menus"/>
      <menuitem name="Returns" parent="fleet_sale" id="fleet_rental_sale_returns" sequence="3" groups="group_fleet_rental_extra_menus"/>
      <menuitem action="action_view_create_return_document_wizard" parent="fleet_sale" id="fleet_rental_create_return" sequence="4"/>
      <menuitem action="action_view_create_extend_document_wizard" parent="fleet_sale" id="fleet_rental_create_extend" sequence="4"/>

      <record id='view_fleet_rental_document_rent_tree' model='ir.ui.view'>
        <field name="name">fleet.rental.document.rent.tree</field>
        <field name="model">fleet_rental.document_rent</field>
        <field name="arch" type="xml">
          <tree string="Vehicle Rent" decoration-muted="state=='cancel'">
            <field name="state" invisible="1"/>
            <field name="name"/>
            <field name="partner_id"/>
            <field name="vehicle_id"/>
            <field name="exit_datetime"/>
            <field name="return_date"/>
            <field name="total_rental_period"/>
          </tree>
        </field>
      </record>

      <record id='fleet_rental_document_draft_act' model='ir.actions.act_window'>
        <field name="name">Draft</field>
        <field name="res_model">fleet_rental.document_rent</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_rent_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','draft')]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_document_draft_act" parent="fleet_rental_document.fleet_rental_sale" id="rent_draft_menu" sequence="1"/>

      <record id='fleet_rental_document_booked_act' model='ir.actions.act_window'>
        <field name="name">Booked</field>
        <field name="res_model">fleet_rental.document_rent</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_rent_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','booked')]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_document_booked_act" parent="fleet_rental_document.fleet_rental_sale" id="rent_booked_menu" sequence="2"/>

      <record id='fleet_rental_document_confirmed_act' model='ir.actions.act_window'>
        <field name="name">Confirmed</field>
        <field name="res_model">fleet_rental.document_rent</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_rent_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','confirmed')]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_document_confirmed_act" parent="fleet_rental_document.fleet_rental_sale" id="rent_confirmed_menu" sequence="3"/>

      <record id='fleet_rental_document_extended_act' model='ir.actions.act_window'>
        <field name="name">Extended</field>
        <field name="res_model">fleet_rental.document_rent</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_rent_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','extended')]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_document_extended_act" parent="fleet_rental_document.fleet_rental_sale" id="rent_extended_menu" sequence="4"/>

      <record id='fleet_rental_document_returned_act' model='ir.actions.act_window'>
        <field name="name">Returned</field>
        <field name="res_model">fleet_rental.document_rent</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_rent_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','returned')]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_document_returned_act" parent="fleet_rental_document.fleet_rental_sale" id="rent_returned_menu" sequence="5"/>

      <record id='fleet_rental_document_canceled_act' model='ir.actions.act_window'>
        <field name="name">Canceled</field>
        <field name="res_model">fleet_rental.document_rent</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_rent_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','cancel')]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_document_canceled_act" parent="fleet_rental_document.fleet_rental_sale" id="rent_canceled_menu" sequence="6"/>

      <!---->
      <record id="view_extends_filter" model="ir.ui.view">
            <field name="name">fleet_rental.document_extend.filter</field>
            <field name="model">fleet_rental.document_extend</field>
            <field name="arch" type="xml">
              <search string="Active">
                  <field name="document_rent_id"/>
              </search>
            </field>
      </record>

      <record model='ir.actions.act_window' id='extends_act'>
          <field name="name">Extend documents</field>
          <field name="res_model">fleet_rental.document_extend</field>
          <field name="view_type">form</field>
          <field name="view_mode">tree,form</field>
          <field name="search_view_id" ref="view_extends_filter"/>
      </record>

      <record id='fleet_rental_document_rent_form' model='ir.ui.view'>
        <field name="name">fleet.rental.document.rent.form</field>
        <field name="model">fleet_rental.document_rent</field>
        <field name="arch" type="xml">
          <form string="Vehicle Rent">
            <header>
              <button name="%(action_view_make_invoice_wizard)d" string="Create Invoice"
                      type="action" class="btn-primary"
                      states="booked" />
              <button name="action_book" string="Book Only"
                      attrs="{'invisible': ['|', '|', '|', '|',
                             ('exit_datetime', '=', False),
                             ('return_date', '=', False),
                             ('partner_id', '=', False),
                             ('vehicle_id', '=', False),
                             ('state', '!=', 'draft')]}"
                      type="object"/>
              <button name="action_cancel_booking" states="booked" string="Cancel Booking" type="object"/>
              <button name="action_confirm" string="Confirm Rental" type="object"
                      attrs="{'invisible': ['|', ('state', '!=', 'booked'), ('advanced_deposit', '&lt;=', 0)]}"/>
              <button name="print_rent" string="Print" type="object"
                      attrs="{'invisible': [('state', 'in', ['draft', 'booked'])]}"/>
              <button name="action_extend" states="confirmed,extended" string="Extend" type="object"/>
              <button name="action_create_return" states="confirmed,extended" string="Create Return Document" type="object"/>
              <field name="state" widget="statusbar" statusbar_visible="draft,booked,confirmed,extended,returned"/>
            </header>
            <sheet>
                <div class="oe_button_box" name="button_box">
                    <button name="action_view_invoice"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-pencil-square-o">
                        <field name="invoice_count" widget="statinfo" string="Invoices"/>
                    </button>
                    <button type="action"
                            class="oe_stat_button"
                            id="extends_button"
                            icon="fa-book"
                            context="{'search_default_document_rent_id': active_id, 'default_model': 'fleet_rental.document_extend', 'default_res_id': active_id}"
                            name="%(extends_act)d">
                        <div class="o_form_field o_stat_info">
                            <span class="o_stat_value">
                                <field name="extends_count"/>
                            </span>
                            <span class="o_stat_text">Extends</span>
                        </div>
                    </button>
                </div>
              <div class="oe_title">
                <h1>
                  <field name="name" readonly="1"/>
                </h1>
              </div>

              <group string="Customer Information">
                <field name="partner_id" attrs="{'readonly': [('state', 'not in', ('draft'))]}" string="Name / Membership ID / ID Number"/>
                <field name="membership_type_id" options='{"no_open": True}'/>
              </group>
              <group string="Vehicle Information">
                <field name="vehicle_id" domain="[('state_id.name','=','Available'),('branch_id','=', user_branch_id)]"
                       attrs="{'readonly': [('state', 'not in', ('draft'))]}" string="Brand / Model / Plate Number"/>
                <field name="vehicle_color_id" options='{"no_open": True}'/>
              </group>
              <group>
                <group col="2" string="Rental Details">
                  <field name="user_branch_id" invisible="True"/>
                  <field name="daily_rental_price" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                  <field name="rate_per_extra_km" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                  <field name="allowed_kilometer_per_day" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                  <field name="odometer_before"/>
                  <field name="exit_datetime" class="oe_inline" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                  <field name="return_date" class="oe_inline" string="Original return date" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                  <field name="extend_return_date" class="oe_inline" string="Extended return date"/>
                  <field name="total_rental_period" class="oe_inline"/>
                  <field name="extra_driver_charge_per_day" class="oe_inline" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                  <field name="other_extra_charges" class="oe_inline" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
                </group>
                <group col="2" string="Payment Details">
                  <field name="period_rent_price" class="oe_inline"/>
                  <field name="extra_driver_charge" class="oe_inline"/>
                  <field name="total_rent_price" class="oe_inline"/>
                  <field name="advanced_deposit" class="oe_inline"/>
                  <field name="balance" class="oe_inline"/>
                </group>
              </group>
              <group string="Additional Drivers">
                  <field name="additional_driver_ids" mode="tree" nolabel="1" widget='one2many'>
                    <tree string="Contacts in emergency cases" editable="bottom">
                      <field name="name"/>
                      <field name="license_type_id"/>
                      <field name="license_number"/>
                      <field name="issuer"/>
                      <field name="license_expiry_date"/>
                    </tree>
                  </field>
              </group>
              <notebook>
                <page string="Vehicle Checklist">
                  <field name="check_line_ids" widget="one2many_list" colspan="4" nolabel="1" mode="tree" attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}">
                    <tree string="Vehicle checklist" editable="bottom" create="0" delete="false" decoration-danger="exit_check_yes and exit_check_no" decoration-success="exit_check_yes and not exit_check_no" decoration-warning="(not exit_check_yes) and exit_check_no">
                      <field name="item_id" options='{"no_open": true}'/>
                      <field name="exit_check_yes"/>
                      <field name="exit_check_no"/>
                    </tree>
                  </field>
                </page>
              </notebook>
              <group>
                <field name="part_line_ids" widget="svg" svg_file="/fleet_rental_document/static/src/img/car-cutout.svg" svg_colors='red:broken;original:operative' svg_id_field="path_ID" svg_color_field="state" nolabel = '1' attrs="{'readonly': [('state', 'not in', ('draft','booked'))]}"/>
              </group>
            </sheet>
          </form>
        </field>
      </record>

      <record id="view_document_rent_filter" model="ir.ui.view">
        <field name="name">fleet_rental.document_rent.select</field>
        <field name="model">fleet_rental.document_rent</field>
        <field name="arch" type="xml">
          <search string="Search Document">
            <field name="name"/>
            <field name="license_plate"/>
          </search>
        </field>
      </record>

    </data>
</openerp>
